<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Click Race - Playing</title>

    <link rel="stylesheet" href="/public/click race game.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Floating binary numbers -->
    <div class="binary-stream" style="top: 13%; left: 42%;">01100110</div>
    <div class="binary-stream" style="top: 32%; left: 70%;">01110101</div>
    <div class="binary-stream" style="top: 83%; left: 80%;">01110101</div>
    <div class="binary-stream" style="top: 24%; left: 23%;">01101011</div>
    <div class="binary-stream" style="top: 66%; left: 70%;">00100000</div>
    <div class="binary-stream" style="top: 10%; left: 86%;">01110011</div>
    <div class="binary-stream" style="top: 40%; left: 20%;">01101111</div>
    <div class="binary-stream" style="top: 76%; left: 45%;">01100011</div>
    <div class="binary-stream" style="top: 20%; left: 6%;">01101001</div>
    <div class="binary-stream" style="top: 60%; left: 12%;">01100101</div>
    <div class="binary-stream" style="top: 87%; left: 22%;">01110100</div>
    <div class="binary-stream" style="top: 47%; left: 95%;">01111001</div>

    <header>
        <a href="click race.html" class="back-button" data-en="← Back to Levels" data-de="← Zurück zu Levels">← Back to Levels</a>
        <h1><span data-en="CLICK RACE - Level" data-de="KLICK RENNEN - Level">CLICK RACE - Level</span> <span id="levelNum">1</span></h1>
    </header>

    <main class="race-container">
        <div class="race-track">
            <div class="player">
                <div class="player-label" data-en="YOU" data-de="DU">YOU</div>
                <div class="track-bar">
                    <div class="player-icon" id="playerIcon">▶</div>
                    <div class="finish-line"></div>
                </div>
            </div>

            <div class="player">
                <div class="player-label" style="color: #FF5555;">BOT</div>
                <div class="track-bar">
                    <div class="player-icon bot-icon" id="botIcon">▶</div>
                    <div class="finish-line"></div>
                </div>
            </div>

            <button class="click-button" id="clickButton" onclick="playerClick()" data-en="CLICK ME!" data-de="DRÜCK MICH!">
                CLICK ME!
            </button>

            <div class="stats">
                <p><span data-en="Clicks" data-de="Klicks">Clicks</span>: <span id="clickCount">0</span> / <span id="targetClicks">100</span></p>
            </div>
        </div>
    </main>

    <div class="game-over" id="gameOver">
        <div class="game-over-content">
            <h2 id="resultTitle">YOU WIN!</h2>
            <p id="resultMessage">You beat the bot!</p>
            <p id="finalStats">Total Clicks: <span id="finalClicks">0</span></p>
            <button onclick="nextLevel()" data-en="Next Level" data-de="Nächstes Level">Next Level</button>
            <button onclick="restart()" data-en="Restart" data-de="Neustart">Restart</button>
            <button onclick="window.location.href='click race.html'" data-en="Main Menu" data-de="Hauptmenü">Main Menu</button>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const currentLevel = parseInt(urlParams.get('level')) || 1;
        
        // Language system
        const lang = localStorage.getItem('language') || 'en';
        const translations = {
            en: {
                clicks: 'Clicks',
                youWin: 'YOU WIN!',
                youLose: 'YOU LOSE!',
                beatBot: 'You beat the bot!',
                botFaster: 'The bot was faster!',
                totalClicks: 'Total Clicks',
                clicksPerSecond: 'Clicks/Second',
                nextLevel: 'Next Level',
                restart: 'Restart',
                mainMenu: 'Main Menu',
                congratulations: 'Congratulations! You beat all levels!',
                clickMe: 'CLICK ME!',
                you: 'YOU'
            },
            de: {
                clicks: 'Klicks',
                youWin: 'DU HAST GEWONNEN!',
                youLose: 'DU HAST VERLOREN!',
                beatBot: 'Du hast den Bot geschlagen!',
                botFaster: 'Der Bot war schneller!',
                totalClicks: 'Gesamt Klicks',
                clicksPerSecond: 'Klicks/Sekunde',
                nextLevel: 'Nächstes Level',
                restart: 'Neustart',
                mainMenu: 'Hauptmenü',
                congratulations: 'Glückwunsch! Du hast alle Level geschafft!',
                clickMe: 'DRÜCK MICH!',
                you: 'DU'
            }
        };
        const t = translations[lang];
        
        document.getElementById('levelNum').textContent = currentLevel;

        let playerProgress = 0;
        let botProgress = 0;
        let clickCount = 0;
        let gameActive = false;
        let botInterval;
        let countdown = 3;
        let startTime = 0;
        let endTime = 0;

        const botSpeeds = {
            1: 0.4,
            2: 0.6,
            3: 0.75,
            4: 0.85,
            5: 1.05
        };

        const winThresholds = {
            1: 100,
            2: 150,
            3: 200,
            4: 250,
            5: 300
        };

        const maxProgress = winThresholds[currentLevel];
        const botSpeed = botSpeeds[currentLevel];
        
        document.getElementById('targetClicks').textContent = maxProgress;

        function startGame() {
            playerProgress = 0;
            botProgress = 0;
            clickCount = 0;
            countdown = 3;

            document.getElementById('clickCount').textContent = 0;
            document.getElementById('clickButton').disabled = true;
            document.getElementById('clickButton').style.opacity = '0.5';
            
            updatePositions();
            
            const countdownInterval = setInterval(() => {
                countdown--;
                document.getElementById('clickButton').textContent = countdown > 0 ? countdown : 'GO!';
                
                if (countdown === 0) {
                    clearInterval(countdownInterval);
                    setTimeout(() => {
                        document.getElementById('clickButton').textContent = t.clickMe;
                        document.getElementById('clickButton').disabled = false;
                        document.getElementById('clickButton').style.opacity = '1';
                        gameActive = true;
                        startTime = Date.now();
                        startBot();
                    }, 500);
                }
            }, 1000);
        }

        function playerClick() {
            if (!gameActive) return;

            clickCount++;
            playerProgress += 1;
            document.getElementById('clickCount').textContent = clickCount;

            updatePositions();
            checkWin();
        }

        function startBot() {
            botInterval = setInterval(() => {
                if (!gameActive) return;

                botProgress += botSpeed;
                updatePositions();
                checkWin();
            }, 100);
        }

        function updatePositions() {
            const playerPercent = Math.min((playerProgress / maxProgress) * 100, 100);
            const botPercent = Math.min((botProgress / maxProgress) * 100, 100);

            document.getElementById('playerIcon').style.left = `calc(${playerPercent}% - 40px)`;
            document.getElementById('botIcon').style.left = `calc(${botPercent}% - 40px)`;
        }

        function checkWin() {
            if (playerProgress >= maxProgress && gameActive) {
                endGame(true);
            } else if (botProgress >= maxProgress && gameActive) {
                endGame(false);
            }
        }

        function endGame(playerWon) {
            gameActive = false;
            endTime = Date.now();
            clearInterval(botInterval);

            const gameOver = document.getElementById('gameOver');
            const resultTitle = document.getElementById('resultTitle');
            const resultMessage = document.getElementById('resultMessage');
            
            const timeTaken = (endTime - startTime) / 1000;
            const clicksPerSecond = (clickCount / timeTaken).toFixed(2);

            if (playerWon) {
                resultTitle.textContent = t.youWin;
                resultTitle.style.color = '#00FF66';
                resultMessage.textContent = t.beatBot;
            } else {
                resultTitle.textContent = t.youLose;
                resultTitle.style.color = '#FF5555';
                resultMessage.textContent = t.botFaster;
            }

            document.getElementById('finalStats').innerHTML = `
                <p>${t.totalClicks}: ${clickCount}</p>
                <p>${t.clicksPerSecond}: ${clicksPerSecond}</p>
            `;
            
            gameOver.style.display = 'flex';
        }

        function nextLevel() {
            if (currentLevel < 5) {
                window.location.href = `click race game.html?level=${currentLevel + 1}`;
            } else {
                alert(t.congratulations);
                window.location.href = 'click race.html';
            }
        }

        function restart() {
            document.getElementById('gameOver').style.display = 'none';
            startGame();
        }

        // Apply translations
        function applyLanguage(lang) {
            document.querySelectorAll('[data-en]').forEach(el => {
                const text = el.getAttribute(`data-${lang}`);
                if (text) el.textContent = text;
            });
        }

        applyLanguage(lang);
        startGame();
    </script>
</body>

</html>
